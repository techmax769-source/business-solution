<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Business Solution ‚Äî Saved Entries</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    :root{
      --bg:#eef3f8;
      --card:#ffffff;
      --muted:#667085;
      --accent:#2563eb;
      --success:#16a34a;
      --danger:#dc2626;
      --radius:14px;
      --glass: rgba(255,255,255,0.6);
    }
    *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}

    body{
      margin:0;
      background:linear-gradient(180deg,#f2f6fb 0%, #eef3f8 100%);
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
      color:#0f172a;
    }

    .topbar{
      width:100%;
      max-width:1000px;
      padding:12px 20px;
      margin-top:18px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:20px;
    }
    .topbar-left{display:flex;align-items:center;gap:15px;}
    .topbar-right{display:flex;align-items:center;gap:10px;}
    .brand{font-weight:800; font-size:18px; letter-spacing:0.2px; color:var(--accent);}

    .top-nav-item{
      padding:6px 10px;
      border-radius:8px;
      text-decoration:none;
      color:#1f2937;
      font-weight:600;
      transition:background 0.2s;
      font-size:14px;
    }
    .top-nav-item:hover{background:#eef3ff;}
    .top-nav-item.active{background:#eef3ff;color:var(--accent);}

    .menu-toggle-btn{
      padding:6px 10px;border-radius:8px;cursor:pointer;color:#1f2937;font-weight:700;
      background:#f1f5f9;border:1px solid #e2e8f0;font-size:16px;line-height:1;
    }
    .menu-toggle-btn:hover{background:#e2e8f0;}

    .main-card{
      width:100%;
      max-width:800px;
      background:var(--card);
      margin-top:8px;
      border-radius:18px; 
      box-shadow:0 10px 30px rgba(15,23,42,0.08);
      padding:25px;
    }

    .field{
      display:flex;
      flex-direction:column;
      margin-bottom: 14px; 
    }
    label{font-size:13px;color:var(--muted);margin-bottom:6px;font-weight:600;}
    input[type="text"], input[type="number"], input[type="date"], select{
      padding:10px 12px;
      border-radius:10px;
      border:1px solid #e6eef8;
      background:#fbfdff;
      font-size:14px;
    }

    .btn{
      padding:10px 14px;border-radius:10px;border:0;font-weight:700;cursor:pointer;
      transition:background 0.2s;
    }
    .btn-primary{background:var(--accent);color:white;}
    .btn-primary:hover{background:#1d4ed8;}
    .btn-ghost{background:transparent;border:1px solid #e6eef8;color:var(--muted);}
    .btn-ghost:hover{background:#f1f5f9;}

    .entries{
      margin-top:20px;
      background:var(--card);
      border-radius:12px;
      padding:12px;
      box-shadow:0 6px 18px rgba(12,17,43,0.03);
    }
    table{width:100%;border-collapse:collapse;font-size:14px;}
    th, td{padding:10px;text-align:left;border-bottom:1px solid #f1f5f9;}
    thead th{color:var(--muted);font-weight:700;font-size:13px;}

    .drawer{
      position:fixed;
      left:0;top:0;height:100vh;width:260px;background:linear-gradient(180deg,#fff,#f7fbff);
      transform:translateX(-110%);
      transition:transform .28s ease;
      box-shadow:6px 0 30px rgba(2,6,23,0.12);
      z-index:80;
      padding:22px;
      display:flex; 
      flex-direction: column; 
    }
    .drawer.open{transform:translateX(0);}

    .drawer-nav-links {
        order: 2; 
        flex-grow: 1; 
        padding-top: 10px;
    }
    .drawer-nav-links a{display:block;padding:10px 6px;color:#0f172a;text-decoration:none;border-radius:8px;margin-bottom:6px;font-weight:600;}
    .drawer-nav-links a:hover{background:#eef3ff;}

    .drawer-header {
      order: 1; 
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 0; 
      padding-bottom: 10px;
      margin-bottom: 10px;
      border-bottom: 1px solid #e6eef8; 
      border-top: none; 
    }
    .drawer-header h3 {
        margin:0;
        color: var(--accent);
    }

    .close-drawer-btn {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--muted);
      padding: 0;
      line-height: 1;
      transition: color 0.2s;
    }
    .close-drawer-btn:hover {
      color: var(--danger);
    }

    .popup{
      position:fixed;right:20px;top:20px;padding:12px 16px;border-radius:10px;color:white;font-weight:700;display:none;z-index:90;
      box-shadow:0 8px 30px rgba(2,6,23,0.18);
    }
    .popup.success{background:var(--success);}
    .popup.loss{background:var(--danger);}

    footer{width:100%;max-width:1000px;margin-top:22px;padding:12px;text-align:center;color:var(--muted);font-weight:600;}

    .live-text { 
      display: inline-flex; 
      align-items: center; 
      gap: 6px; 
      padding: 4px 8px; 
      background: rgba(16, 185, 129, 0.12); 
      border-radius: 8px; 
      color: var(--success); 
      font-size: 13px; 
      font-weight: 700; 
      text-transform: uppercase; 
      letter-spacing: 0.4px; 
    }

    .live-dot { 
      width: 10px; 
      height: 10px; 
      border-radius: 50%; 
      background-color: var(--success); 
      box-shadow: 0 0 6px rgba(16, 185, 129, 0.9); 
      animation: pulse 1.2s ease-out infinite; 
    }

    @keyframes pulse { 
      0% { transform: scale(1); opacity: 1; } 
      50% { transform: scale(1.5); opacity: 0.5; } 
      100% { transform: scale(1); opacity: 1; } 
    }

    .filter-section {
        display: flex;
        gap: 12px;
        margin-bottom: 20px;
        flex-wrap: wrap;
        align-items: flex-end;
    }
    .filter-field {
        flex: 1;
        min-width: 150px;
    }

    .summary-card {
        display: flex;
        justify-content: space-around;
        align-items: center;
        padding: 15px;
        margin-bottom: 20px;
        background: linear-gradient(90deg, #eef3ff, #f7f9ff);
        color: #0f172a;
        border-radius: 12px;
        font-weight: 600;
        box-shadow: 0 4px 15px rgba(37, 99, 235, 0.05);
    }

    .summary-card strong {
        font-size: 18px;
        font-weight: 800;
        margin-left: 8px;
    }

    .delete-btn {
        background: none;
        border: none;
        color: var(--danger);
        font-size: 16px;
        cursor: pointer;
        padding: 2px;
        transition: transform 0.1s;
    }
    .delete-btn:hover {
        transform: scale(1.1);
    }

    @media (max-width:650px){
      .main-card {
          max-width: 95%;
      }
      table, thead, tbody, th, td, tr{display:block;}
      thead{display:none;}
      td{border:none;padding:10px 0;}
      td:before{content:attr(data-label);display:block;font-weight:700;color:var(--muted);margin-bottom:6px;}
      
      .topbar{flex-direction:column;gap:10px;}
      .topbar-left, .topbar-right{width:100%;justify-content:space-between;}
      
      .filter-section {
          flex-direction: column;
          gap: 10px;
      }
      .filter-field {
          min-width: 100%;
      }
      .summary-card {
          flex-direction: column;
          align-items: flex-start;
          gap: 8px;
      }
    }
  </style>
</head>
<body>

  <header class="topbar">
    <div class="topbar-left">
      <button class="menu-toggle-btn" id="menuBtn" title="Menu">‚ò∞</button>
      <div class="brand" style="margin-left: auto;">Business Solution</div> 
    </div>
    <div class="topbar-right">
      <a class="top-nav-item" href="index.html">üè† Home</a>
      <a class="top-nav-item active" href="saved_entries.html">üíæ Saved Entries</a>
    </div>
  </header>

  <nav id="drawer" class="drawer" aria-hidden="true">
    <div class="drawer-header">
      <h3>Menu</h3>
      <button id="closeDrawerBtn" class="close-drawer-btn" title="Close Menu">‚úñ</button>
    </div>
    <div class="drawer-nav-links">
        <a href="index.html">üè† Home</a>
        <a href="saved_entries.html">üíæ Saved Entries</a>
    </div>
  </nav>

  <main class="main-card" role="main" aria-labelledby="saved-heading">
    <h2 id="saved-heading" style="margin:0 0 18px 0; border-bottom:1px solid #f1f5f9; padding-bottom:8px;">Saved Entries Dashboard</h2>

    <div class="filter-section">
      <div class="field filter-field">
        <label for="filterDate">Filter by Date</label>
        <input id="filterDate" type="date">
      </div>
      <div class="field filter-field">
        <label for="filterDay">Filter by Day</label>
        <select id="filterDay">
          <option value="">All Days</option>
          <option>Monday</option><option>Tuesday</option><option>Wednesday</option>
          <option>Thursday</option><option>Friday</option><option>Saturday</option><option>Sunday</option>
        </select>
      </div>
      <div class="field filter-field">
        <label for="searchProduct">Search Product</label>
        <input id="searchProduct" type="text" placeholder="e.g., Desktop">
      </div>
      <div class="field filter-field">
        <button id="resetFilters" class="btn btn-ghost" style="margin-top:10px;">Reset Filters</button>
      </div>
    </div>
    
    <div class="summary-card">
        <div>Total Entries: <strong id="totalEntries">0</strong></div>
        <div>Total Profit: <strong id="totalProfit">KES 0.00</strong></div>
    </div>

    <section class="entries" aria-labelledby="entries-list">
      <h3 id="entries-list" style="margin-top:0;margin-bottom:8px;">
        Entry List 
        <span class="live-text">
          <span class="live-dot"></span>
          LIVE
        </span>
      </h3>
      <div style="overflow:auto;">
        <table aria-describedby="entries-list">
          <thead>
            <tr>
              <th>Date</th><th>Day</th><th>Product</th><th># Sold</th><th>Price</th><th>Cost/item</th><th>Profit (KES)</th><th>%</th><th>Actions</th>
            </tr>
          </thead>
          <tbody id="entriesBody">
            <tr><td colspan="9" style="text-align:center; color:var(--muted);">Loading entries...</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <footer>Created by Max ‚Ä¢ Business Solution ¬© 2025</footer>

  <div id="popup" class="popup" role="status" aria-live="polite"></div>

  <script type="module">
    // Firebase imports (v10 modular)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      query,
      orderBy,
      onSnapshot,
      deleteDoc,
      doc
    } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";

    // ======= ‚úÖ Your Firebase Config (Inserted Exactly As Requested) ========
    const firebaseConfig = {
      apiKey: "AIzaSyBzDK4KUc5koGLlIEQh8gh_97Ax8qoDG1w",
      authDomain: "max-movies-84567.firebaseapp.com",
      databaseURL: "https://max-movies-84567-default-rtdb.firebaseio.com",
      projectId: "max-movies-84567",
      storageBucket: "max-movies-84567.firebasestorage.app",
      messagingSenderId: "475076851687",
      appId: "1:475076851687:web:b4531c756ed2f4c39eaf42"
    };
    // ======================================================================

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const entriesCol = collection(db, "businessEntries");

    const entriesBody = document.getElementById("entriesBody");
    const totalEntriesEl = document.getElementById("totalEntries");
    const totalProfitEl = document.getElementById("totalProfit");
    const filterDateEl = document.getElementById("filterDate");
    const filterDayEl = document.getElementById("filterDay");
    const searchProductEl = document.getElementById("searchProduct");
    const resetFiltersBtn = document.getElementById("resetFilters");
    const popupEl = document.getElementById("popup");
    const drawer = document.getElementById("drawer");
    const menuBtn = document.getElementById("menuBtn");
    const closeDrawerBtn = document.getElementById("closeDrawerBtn"); 

    const fmtKES = n => {
        const value = Number(n);
        return `KES ${value.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
    };
    const fmtKESSign = n => {
        const value = Number(n);
        const sign = value >= 0 ? (value === 0 ? '' : '+') : '';
        return `${sign}${value.toLocaleString(undefined, {minimumFractionDigits:2, maximumFractionDigits:2})}`;
    };
    const fmtPct = n => {
        const value = Number(n);
        const sign = value >= 0 ? (value === 0 ? '' : '+') : '';
        return `${sign}${value.toFixed(2)}%`;
    };
    function showPopup(message, positive=true){
      popupEl.textContent = message;
      popupEl.className = "popup " + (positive ? "success" : "loss");
      popupEl.style.display = "block";
      setTimeout(()=> popupEl.style.display = "none", 2500);
    }

    menuBtn.addEventListener("click", () => {
      drawer.classList.toggle("open");
    });
    closeDrawerBtn.addEventListener("click", () => {
      drawer.classList.remove("open");
    });

    async function handleDelete(id){
        if (!confirm("Are you sure you want to delete this entry?")) return;
        try {
            await deleteDoc(doc(db, "businessEntries", id));
            showPopup("Entry deleted successfully.", false);
        } catch (e) {
            console.error("Error deleting document: ", e);
            showPopup("Failed to delete entry.", false);
        }
    }

    const q = query(entriesCol, orderBy("createdAt", "desc"));
    
    let allEntries = [];

    onSnapshot(q, snapshot => {
      allEntries = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
      renderEntries();
    });

    function renderEntries(){
        const filterDate = filterDateEl.value.trim();
        const filterDay = filterDayEl.value;
        const searchProduct = searchProductEl.value.trim().toLowerCase();
        
        let filteredEntries = allEntries.filter(doc => {
            let passesDate = true;
            if (filterDate && doc.dateString) {
                passesDate = doc.dateString === filterDate;
            }

            let passesDay = true;
            if (filterDay) {
                passesDay = doc.day === filterDay;
            }

            let passesProduct = true;
            if (searchProduct) {
                passesProduct = (doc.product || "").toLowerCase().includes(searchProduct);
            }

            return passesDate && passesDay && passesProduct;
        });

        entriesBody.innerHTML = "";
        let totalProfit = 0;

        if (filteredEntries.length === 0) {
            entriesBody.innerHTML = '<tr><td colspan="9" style="text-align:center; color:var(--muted);">No matching entries found.</td></tr>';
        } else {
            filteredEntries.forEach(doc => {
                const profitVal = Number(doc.profit) || 0;
                const percentVal = Number(doc.percent) || 0;
                const costDisplay = (doc.originalPrice !== undefined && doc.originalPrice !== "") ? ("KES " + Number(doc.originalPrice).toFixed(2)) : "-";
                
                totalProfit += profitVal;
                
                const tr = document.createElement("tr");
                tr.innerHTML = `
                  <td data-label="Date">${doc.dateString || "-"}</td>
                  <td data-label="Day">${doc.day || "-"}</td>
                  <td data-label="Product">${doc.product || "-"}</td>
                  <td data-label="# Sold">${doc.numberSold ?? 0}</td>
                  <td data-label="Price">KES ${Number(doc.itemPrice ?? 0).toFixed(2)}</td>
                  <td data-label="Cost/item">${costDisplay}</td>
                  <td data-label="Profit" style="font-weight:700; color:${profitVal >= 0 ? 'var(--success)' : 'var(--danger)'}">KES ${fmtKESSign(profitVal)}</td>
                  <td data-label="%">${fmtPct(percentVal)}</td>
                  <td data-label="Actions">
                    <button class="delete-btn" data-id="${doc.id}" title="Delete Entry">üóëÔ∏è</button>
                  </td>
                `;
                entriesBody.appendChild(tr);
            });
            
            entriesBody.querySelectorAll(".delete-btn").forEach(button => {
                button.addEventListener('click', (e) => handleDelete(e.currentTarget.dataset.id));
            });
        }
        
        totalEntriesEl.textContent = filteredEntries.length;
        totalProfitEl.textContent = fmtKES(totalProfit);
        totalProfitEl.style.color = totalProfit >= 0 ? 'var(--success)' : 'var(--danger)';
    }
    
    [filterDateEl, filterDayEl, searchProductEl].forEach(el => el.addEventListener("input", renderEntries));
    
    resetFiltersBtn.addEventListener("click", () => {
        filterDateEl.value = "";
        filterDayEl.value = "";
        searchProductEl.value = "";
        renderEntries();
    });
    
    renderEntries(); 

  </script>
</body>
</html>
